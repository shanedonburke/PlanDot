<div class="page-container">
  <mat-toolbar color="primary">
    <mat-toolbar-row>
      <span>plan0</span>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-toolbar>
    <mat-toolbar-row class="secondary-row">
      <button
        (click)="addNewItem()"
        mat-raised-button
        color="primary"
        class="new-item-btn"
      >
        New item
      </button>
      <button (click)="toggleGroupsMenu($event)" mat-button>Groups</button>
      <button (click)="userAuthService.login()" mat-button>Login</button>
      <div
        *ngIf="isGroupsMenuVisible"
        (click)="$event.stopPropagation()"
        class="groups-menu"
      >
        <div class="groups-menu-row-container">
          <div
            *ngFor="let group of groupService.getGroups(); index as i"
            class="groups-menu-row"
          >
            <div class="groups-menu-row-content">
              <div
                [style.color]="groupService.getGroupTextColor(group)"
                [style.backgroundColor]="group.color"
                class="group-name-chip"
              >
                {{ group.name }}
              </div>
              <div class="groups-menu-row-controls">
                <button (click)="editGroup(group)" mat-icon-button>
                  <mat-icon>edit</mat-icon>
                </button>
                <button (click)="deleteGroup(group)" mat-icon-button>
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </div>
            <mat-divider></mat-divider>
          </div>
        </div>
        <button (click)="addGroup()" mat-button class="new-group-btn">
          New group
        </button>
      </div>
    </mat-toolbar-row>
  </mat-toolbar>
  <div class="group-view-container">
    <div *ngFor="let group of groupService.getGroups()" class="group-wrapper">
      <div class="group">
        <div class="group-header">
          <div
            [style.color]="groupService.getGroupTextColor(group)"
            [style.backgroundColor]="group.color"
            class="group-name-chip"
          >
            {{ group.name }}
          </div>
          <button mat-icon-button [matMenuTriggerFor]="sortMenu">
            <mat-icon>sort</mat-icon>
          </button>
          <mat-menu #sortMenu="matMenu">
            <button mat-menu-item (click)="sortByDate(group)">
              <mat-icon>event</mat-icon>
              <span>Date</span>
            </button>
            <button mat-menu-item (click)="sortByTitle(group)">
              <mat-icon>sort_by_alpha</mat-icon>
              <span>Title</span>
            </button>
          </mat-menu>
        </div>
        <div
          class="group-item-list"
          cdkDropList
          (cdkDropListDropped)="dropGroupItem(group, $event)"
        >
          <div
            *ngFor="let item of itemService.getGroupItems(group)"
            class="group-item"
            cdkDrag
          >
            <span class="group-item-title">{{ item.title }}</span>
            <span class="group-item-description">{{ item.description }}</span>
            <div style="flex-grow: 1"></div>
            <div style="display: flex">
              <div class="group-item-date" *ngIf="item.dateEnabled">
                <mat-icon>event</mat-icon>
                <span>{{ item.date.toLocaleDateString() }}</span>
              </div>
              <div class="group-item-date" *ngIf="item.timeEnabled">
                <mat-icon>schedule</mat-icon>
                <span>{{ getDisplayTime(item) }}</span>
              </div>
            </div>
          </div>
        </div>
        <button
          (click)="addNewItemToGroup(group)"
          mat-button
          class="new-group-item-btn"
        >
          New item
        </button>
      </div>
    </div>
  </div>
</div>
